<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Phync : Simple rsync wrapper in PHP" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Phync</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/yuya-takeyama/phync">View on GitHub</a>

          <h1 id="project_title">Phync</h1>
          <h2 id="project_tagline">Simple rsync wrapper in PHP</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/yuya-takeyama/phync/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/yuya-takeyama/phync/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="phync" class="anchor" href="#phync"><span class="octicon octicon-link"></span></a>Phync</h1>

<p>develop: <a href="https://travis-ci.org/yuya-takeyama/phync"><img src="https://travis-ci.org/yuya-takeyama/phync.png?branch=develop" alt="Build Status"></a>
master: <a href="https://travis-ci.org/yuya-takeyama/phync"><img src="https://travis-ci.org/yuya-takeyama/phync.png?branch=master" alt="Build Status"></a></p>

<p>PHP による <code>rsync</code> ラッパ</p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ol>
<li>
<code>rsync</code> のラッパとして動作し、複雑な <code>rsync</code> コマンドを簡単に生成・実行できる。</li>
<li>複数のサーバにまとめてシンクできる。</li>
<li>プロジェクトルートから全体のシンクができる。</li>
<li>プロジェクトツリー内の一部のファイル・ディレクトリだけを選択してシンクできる。</li>
<li>デフォルト動作は <code>rsync --dry-run</code> となっており、確認が安全に行える。</li>
</ol><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<h3>
<a name="phync-%E6%9C%AC%E4%BD%93" class="anchor" href="#phync-%E6%9C%AC%E4%BD%93"><span class="octicon octicon-link"></span></a>phync 本体</h3>

<p>GitHub から <code>git</code> コマンドで直接インストールできます。<br>
ワークツリーの <code>./bin</code> ディレクトリを <code>$PATH</code> に追加することで <code>phync</code> コマンドが使用できるようになります。</p>

<pre><code>$ git clone https://github.com/yuya-takeyama/phync.git ~/.phync
</code></pre>

<p>GitHub の Subversion インターフェイスを使用すれば <code>svn</code> コマンドでもインストールできます。</p>

<pre><code>$ svn co https://github.com/yuya-takeyama/phync/trunk ~/.phync
</code></pre>

<h3>
<a name="%E5%90%84%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" class="anchor" href="#%E5%90%84%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><span class="octicon octicon-link"></span></a>各プロジェクトへのインストール</h3>

<p>各プロジェクトごとに設定ファイル、ログディレクトリを設置する必要があります。</p>

<p><code>phync</code> コマンドの実行時に、カレントディレクトリ内の <code>.phync/config.php</code> を読み込みます。</p>

<p>また、ログディレクトリはデフォルトでは <code>.phync/log</code> となっており、予め作成しておく必要があります。</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a name="%E3%83%89%E3%83%A9%E3%82%A4%E3%83%A9%E3%83%B3" class="anchor" href="#%E3%83%89%E3%83%A9%E3%82%A4%E3%83%A9%E3%83%B3"><span class="octicon octicon-link"></span></a>ドライラン</h3>

<p>デフォルトの動作は <code>rsync --dry-run</code> によるドライランです。<br>
ドライランを行うと、実行時にどのような変更が行われるかを確認できます。  </p>

<p>引数を指定しなければ、プロジェクト全体が対象となります。</p>

<pre><code>$ phync
# 以下のようなコマンドが生成される
# rsync -av --dry-run --delete '/project/' 'example.com:/project/'
</code></pre>

<p>引数を指定することで、一部のファイル・ディレクトリのみを対象とすることができます。<br>
また、同時に複数のファイル・ディレクトリを指定することが出来ます。</p>

<pre><code># ファイル
$ phync path/to/file
# 以下のようなコマンドが生成される
# rsync -av --dry-run --delete '/project/' 'example.com:/project/' --include '/path/to/file' --include '/path/to/' --include '/path/' --exclude '*'

# ディレクトリ
$ phync path/to/dir
# 以下のようなコマンドが生成される
# rsync -av --dry-run --delete '/project/' 'example.com:/project/' --include '/path/to/dir/' --include '/path/to/dir/*' --include '/path/to/dir/**/*' --exclude '*'

# 複数まとめて
$ phync path/to/file path/to/dir
# 以下のようなコマンドが生成される
# rsync -av --dry-run --delete '/project/' 'example.com:/project/' --include '/path/to/file' --include '/path/to/' --include '/path/' --include '/path/to/dir/' --include '/path/to/dir/*' --include '/path/to/dir/**/*' --exclude '*'
</code></pre>

<h3>
<a name="%E3%82%B7%E3%83%B3%E3%82%AF%E3%81%AE%E5%AE%9F%E8%A1%8C" class="anchor" href="#%E3%82%B7%E3%83%B3%E3%82%AF%E3%81%AE%E5%AE%9F%E8%A1%8C"><span class="octicon octicon-link"></span></a>シンクの実行</h3>

<p><code>phync</code> コマンドの実行時に <code>--execute</code> オプションを付加することで、シンクが実行されます。</p>

<p>このとき生成される <code>rsync</code> コマンドは、ドライラン時のものから <code>--dry-run</code> オプションのみが除かれたものです。</p>

<pre><code># ファイル
$ phync --execute path/to/file

# ディレクトリ
$ phync --execute path/to/dir

# 複数まとめて
$ phync --execute path/to/file path/to/dir
</code></pre>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>カレントディレクトリ内の <code>.phync/config.php</code> が設定ファイルとなります。<br>
設定値は PHP の連想配列として記述できます。</p>

<h3>
<a name="%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%A8%98%E8%BF%B0%E4%BE%8B" class="anchor" href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%A8%98%E8%BF%B0%E4%BE%8B"><span class="octicon octicon-link"></span></a>設定ファイルの記述例</h3>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'destinations'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'foo.example.com'</span><span class="p">,</span>
        <span class="s1">'bar.example.com'</span><span class="p">,</span>
        <span class="s1">'baz.example.com'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'exclude_from'</span> <span class="o">=&gt;</span> <span class="s1">'exclude.lst'</span><span class="p">,</span>
    <span class="s1">'rsync_path'</span>   <span class="o">=&gt;</span> <span class="s1">'/usr/bin/rsync'</span><span class="p">,</span>
    <span class="s1">'rsh'</span>          <span class="o">=&gt;</span> <span class="s1">'/usr/bin/ssh'</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>

<h3>
<a name="%E5%90%84%E8%A8%AD%E5%AE%9A%E5%80%A4%E3%81%AE%E8%A9%B3%E7%B4%B0" class="anchor" href="#%E5%90%84%E8%A8%AD%E5%AE%9A%E5%80%A4%E3%81%AE%E8%A9%B3%E7%B4%B0"><span class="octicon octicon-link"></span></a>各設定値の詳細</h3>

<table>
<thead><tr>
<th>項目名</th>
<th>説明</th>
<th>必須</th>
<th>設定例</th>
</tr></thead>
<tbody>
<tr>
<td>destinations</td>
<td>シンク先サーバのホスト名を配列で指定する。</td>
<td>Yes</td>
<td><code>array('server1.example.net', 'server2.example.net')</code></td>
</tr>
<tr>
<td>ssh_user</td>
<td>対象ホストへの接続に使用する SSH ユーザ名。</td>
<td>No</td>
<td><code>'testuser'</code></td>
</tr>
<tr>
<td>remote_target_dir</td>
<td>リモートの対象ディレクトリへのパス。デフォルトではローカルのカレントと同じパスが対象となる。</td>
<td>No</td>
<td><code>'/path/to/target-directory'</code></td>
</tr>
<tr>
<td>exclude_from</td>
<td>
<code>rsync</code> コマンドの <code>--exclude-from</code> オプション。除外ファイルの一覧を記述したファイルを指定する。</td>
<td>No</td>
<td><code>dirname(__FILE__) . '/rsync_exclude'</code></td>
</tr>
<tr>
<td>rsync_path</td>
<td>
<code>rsync</code> コマンドの <code>--rsync-path</code> オプション。</td>
<td>No</td>
<td><code>'/usr/bin/rsync'</code></td>
</tr>
<tr>
<td>rsh</td>
<td>
<code>rsync</code> コマンドの <code>--rsh</code> オプション。</td>
<td>No</td>
<td><code>'/usr/bin/ssh'</code></td>
</tr>
<tr>
<td>default_checksum</td>
<td>
<code>true</code> にすると <code>rsync</code> コマンドに <code>--checksum</code> オプションが付加される。デフォルトは <code>false</code>。</td>
<td>No</td>
<td><code>true</code></td>
</tr>
<tr>
<td>log_directory</td>
<td>ログファイルを保存するディレクトリのパス。でフォルトは <code>.phync/log</code>
</td>
<td>No</td>
<td><code>'/path/to/log-directory'</code></td>
</tr>
</tbody>
</table><h3>
<a name="%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%91%E3%82%B9%E3%81%AE%E6%8C%87%E5%AE%9A" class="anchor" href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%91%E3%82%B9%E3%81%AE%E6%8C%87%E5%AE%9A"><span class="octicon octicon-link"></span></a>設定ファイルパスの指定</h3>

<p>v0.5.0 より <code>--config=FILE</code> オプションを指定することで、デフォルトとは別の設定ファイルを読み込めるようになりました。</p>

<h2>
<a name="author" class="anchor" href="#author"><span class="octicon octicon-link"></span></a>Author</h2>

<p>Yuya Takeyama</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Phync maintained by <a href="https://github.com/yuya-takeyama">yuya-takeyama</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
